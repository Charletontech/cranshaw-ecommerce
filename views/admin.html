<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-3.4.1-dist/css/bootstrap.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | CranShaw</title>
    <style>
      *{
        padding: 0;
        box-sizing: border-box;
        margin: 0;
        text-decoration: none;
        list-style: none;
      }

      .gen-container{
        width: 95%;
        display: block;
        margin: auto;
      }
    </style>
</head>
<body>
  <ul class="nav nav-pills">
    <li class="nav-item">
      <a class="nav-link active" aria-current="page" href="#">Add Product</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Edit Product</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Customers</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Orders</a>
    </li>
  </ul>
  <section class="gen-container">
    <div id="liveAlertPlaceholder" style="position: absolute; top: 10%;"></div>
  
  

  <form id="productForm" method="post" action="/add-product" enctype="multipart/form-data" onsubmit="return false">
    <h2>Add Product Form</h2>
    
    <div class="mb-3">
      <label  class="form-label">Product Image</label>
      <input type="file" class="form-control" name="productImage">
      <div  class="form-text">Small sized images are highly recommended (2mb maximum).</div>
    </div>

    <div class="mb-3">
      <label  class="form-label">Product Name</label>
      <input type="text" class="form-control" name="productName">
    </div>


    <div class="mb-3">
      <label  class="form-label">Price</label>
      <input type="number" placeholder="&#8358;" class="form-control" name="price">
    </div>

    <div class="mb-3">
      <label  class="form-label">Category</label>
      <select class="form-control"name="category">
        <option value="Electronics">Electronics</option>
        <option value="Household">Household</option>
        <option value="Gadgets">Gadgets</option>
        <option value="Foodstuff">Foodstuff</option>
        <option value="Clothing">Clothing</option>
        <option value="Shoes">Shoes</option>
        <option value="Accessories">Accessories</option>
      </select>
    </div>
    
    <div class="mb-3">
      <label  class="form-label">Quantity</label>
      <input type="number" name="qty" class="form-control" name="qty" readonly value="1">
      <div  class="form-text">You can not edit this field.</div>
    </div>
    <button type="submit" class="btn btn-primary" onclick="submitForm(e = this)">Submit</button>
  </form>
</section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
        let wrapper;
        const appendAlert = (message, type) => {
          wrapper = document.createElement('div')
          wrapper.innerHTML = [
            `<div class="alert alert-${type} alert-dismissible" role="alert" style="display:flex; align-items: center; justify-content: space-between;">`,
            `   <div>${message}</div>`,
            '   <button type="button" style="background: transparent;" class="btn" data-bs-dismiss="alert" aria-label="Close"><span class="glyphicon glyphicon-remove"></span></button>',
            '</div>'
          ].join('')

          alertPlaceholder.append(wrapper)
        }


        function submitForm(e) {
          e.innerHTML = "Sending, Please wait...";
        return new Promise((resolve, reject) => {
          const form = document.getElementById('productForm');
          const formData = new FormData(form);

          fetch('/add-product', {
            method: 'POST',
            body: formData
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.text();
          })
          .then(data => {
            // Resolve the promise with response data
            resolve(data);
            
            // Display success message
            appendAlert('Success! Product has been added to database. You can fill the form again to add a new product.', 'success');
            e.innerHTML = "Submit";
          })
          .catch(error => {
            // Reject the promise with error
            reject(error);

            // Display error message
            appendAlert('Failed, An error occurred while adding product', 'danger');
            e.innerHTML = "Submit";
          });
        });
      }

    </script>
</body>
</html>